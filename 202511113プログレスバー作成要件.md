# ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ä½œæˆè¦ä»¶

## ç¾çŠ¶åˆ†æ

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ§‹æˆ
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: é™çš„HTML/CSS/JSï¼ˆS3 + CloudFrontï¼‰
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: Step Functionsï¼ˆLambdaä¸ä½¿ç”¨ï¼‰
- **ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢**: S3ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ã®ã¿ï¼‰
- **å‡¦ç†ãƒ•ãƒ­ãƒ¼**: S3ã‚¤ãƒ™ãƒ³ãƒˆ â†’ Step Functions â†’ Transcribe â†’ Bedrock â†’ Comprehend

### ç¾åœ¨ã®å•é¡Œç‚¹
- å‡¦ç†çŠ¶æ³ãŒã€Œå‡¦ç†ä¸­...ã€ã‹ã‚‰æ›´æ–°ã•ã‚Œãªã„
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å‡¦ç†ã®é€²æ—ï¼ˆæ–‡å­—èµ·ã“ã—ä¸­ã€è¦ç´„ä¸­ã€æ„Ÿæƒ…åˆ†æä¸­ï¼‰ãŒåˆ†ã‹ã‚‰ãªã„
- DynamoDBãŒå­˜åœ¨ã›ãšã€ã‚¸ãƒ§ãƒ–ç®¡ç†ãŒã§ãã¦ã„ãªã„

## ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼å®Ÿè£…æ–¹é‡

### å‡¦ç†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å®šç¾©
1. **UPLOADED** - ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†
2. **TRANSCRIBING** - æ–‡å­—èµ·ã“ã—ä¸­ï¼ˆTranscribeå®Ÿè¡Œä¸­ï¼‰
3. **SUMMARIZING** - è¦ç´„ä¸­ï¼ˆBedrockå®Ÿè¡Œä¸­ï¼‰
4. **ANALYZING** - æ„Ÿæƒ…åˆ†æä¸­ï¼ˆComprehendå®Ÿè¡Œä¸­ï¼‰
5. **COMPLETED** - å…¨å‡¦ç†å®Œäº†
6. **ERROR** - ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ

---

## é–‹ç™ºã‚¿ã‚¹ã‚¯

### 1. ã‚¤ãƒ³ãƒ•ãƒ©ï¼ˆDynamoDBä½œæˆ + Step Functionsä¿®æ­£ï¼‰

#### ã‚¿ã‚¹ã‚¯1-0: DynamoDB ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
**ç›®çš„**: ã‚¸ãƒ§ãƒ–ç®¡ç†ç”¨ã®DynamoDBãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ–°è¦ä½œæˆ

**ãƒ†ãƒ¼ãƒ–ãƒ«ä»•æ§˜**:
```
ãƒ†ãƒ¼ãƒ–ãƒ«å: minutes-app-team-a-dynamodb
ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚­ãƒ¼: job_id (String)
èª²é‡‘ãƒ¢ãƒ¼ãƒ‰: ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰
```

**å±æ€§**:
- `job_id` (String) - ã‚¸ãƒ§ãƒ–IDï¼ˆãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ï¼‰
- `user_id` (String) - ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
- `file_name` (String) - ãƒ•ã‚¡ã‚¤ãƒ«å
- `file_size` (Number) - ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º
- `file_type` (String) - ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—
- `status` (String) - å‡¦ç†çŠ¶æ…‹
- `created_at` (String) - ä½œæˆæ—¥æ™‚
- `updated_at` (String) - æ›´æ–°æ—¥æ™‚
- `s3_upload_key` (String) - ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰S3ã‚­ãƒ¼
- `transcript_s3_key` (String) - æ–‡å­—èµ·ã“ã—çµæœS3ã‚­ãƒ¼
- `summary_s3_key` (String) - è¦ç´„çµæœS3ã‚­ãƒ¼
- `sentiment_s3_key` (String) - æ„Ÿæƒ…åˆ†æçµæœS3ã‚­ãƒ¼
- `error_message` (String) - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

**ä½œæˆæ–¹æ³•**:
- AWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰æ‰‹å‹•ä½œæˆ
- ã¾ãŸã¯AWS CLIã‚³ãƒãƒ³ãƒ‰:
```bash
aws dynamodb create-table \
  --table-name minutes-app-team-a-dynamodb \
  --attribute-definitions AttributeName=job_id,AttributeType=S \
  --key-schema AttributeName=job_id,KeyType=HASH \
  --billing-mode PAY_PER_REQUEST \
  --region ap-northeast-1
```

### 1. ã‚¤ãƒ³ãƒ•ãƒ©ï¼ˆStep Functionsä¿®æ­£ï¼‰

#### ã‚¿ã‚¹ã‚¯1-1: DynamoDBæ›´æ–°ã‚¹ãƒ†ãƒƒãƒ—ã®è¿½åŠ 
**ç›®çš„**: å„å‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—ã®é–‹å§‹æ™‚ã«DynamoDBã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°

**ä¿®æ­£ç®‡æ‰€**: `statemachine.json`

**è¿½åŠ ã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ—**:
```json
{
  "UpdateStatusTranscribing": {
    "Type": "Task",
    "Resource": "arn:aws:states:::dynamodb:updateItem",
    "Parameters": {
      "TableName": "minutes-app-team-a-dynamodb",
      "Key": {
        "job_id": {"S.$": "$.Job_ID"}
      },
      "UpdateExpression": "SET #status = :status, updated_at = :updatedAt",
      "ExpressionAttributeNames": {
        "#status": "status"
      },
      "ExpressionAttributeValues": {
        ":status": {"S": "TRANSCRIBING"},
        ":updatedAt": {"S.$": "$$.State.EnteredTime"}
      }
    },
    "ResultPath": "$.UpdateResult",
    "Next": "Transcribe"
  }
}
```

**æŒ¿å…¥ä½ç½®**:
- `CreateCleanJobId` â†’ **UpdateStatusTranscribing** â†’ `Transcribe`
- `SaveTranscriptAsText` â†’ **UpdateStatusSummarizing** â†’ `PrepareParallel`
- `StartSentimentDetectionJob` ã®å‰ã« **UpdateStatusAnalyzing**

#### ã‚¿ã‚¹ã‚¯1-2: å®Œäº†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
**ä¿®æ­£ç®‡æ‰€**: `ParallelAnalysis` ã®çµ‚äº†å¾Œ

**è¿½åŠ ã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ—**:
```json
{
  "UpdateStatusCompleted": {
    "Type": "Task",
    "Resource": "arn:aws:states:::dynamodb:updateItem",
    "Parameters": {
      "TableName": "minutes-app-team-a-dynamodb",
      "Key": {
        "job_id": {"S.$": "$.Process_ID"}
      },
      "UpdateExpression": "SET #status = :status, updated_at = :updatedAt, transcript_s3_key = :transcript, summary_s3_key = :summary, sentiment_s3_key = :sentiment",
      "ExpressionAttributeNames": {
        "#status": "status"
      },
      "ExpressionAttributeValues": {
        ":status": {"S": "COMPLETED"},
        ":updatedAt": {"S.$": "$$.State.EnteredTime"},
        ":transcript": {"S.$": "States.Format('output-transcribe/transcribe_{}.txt', $.Process_ID)"},
        ":summary": {"S.$": "States.Format('output-bedrock/summary_{}.html', $.Process_ID)"},
        ":sentiment": {"S.$": "States.Format('output-comprehend/comprehend_{}.tar.gz', $.Process_ID)"}
      }
    },
    "End": true
  }
}
```

#### ã‚¿ã‚¹ã‚¯1-3: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
**è¿½åŠ **: å„ã‚¹ãƒ†ãƒƒãƒ—ã« `Catch` ãƒ–ãƒ­ãƒƒã‚¯ã‚’è¿½åŠ ã—ã¦ã‚¨ãƒ©ãƒ¼æ™‚ã« `ERROR` ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°

---

### 2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆWeb UIï¼‰

#### ã‚¿ã‚¹ã‚¯2-1: ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼UIè¿½åŠ 
**ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«**: `web/index.html`

**è¿½åŠ HTML**:
```html
<section class="progress-section" id="progress-section" style="display: none;">
    <h2>ğŸ“Š å‡¦ç†é€²æ—</h2>
    <div class="progress-container">
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="progress-steps">
            <div class="step" id="step-upload">
                <div class="step-icon">ğŸ“</div>
                <div class="step-label">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</div>
            </div>
            <div class="step" id="step-transcribe">
                <div class="step-icon">ğŸ¤</div>
                <div class="step-label">æ–‡å­—èµ·ã“ã—</div>
            </div>
            <div class="step" id="step-summarize">
                <div class="step-icon">ğŸ“</div>
                <div class="step-label">è¦ç´„</div>
            </div>
            <div class="step" id="step-analyze">
                <div class="step-icon">ğŸ˜Š</div>
                <div class="step-label">æ„Ÿæƒ…åˆ†æ</div>
            </div>
            <div class="step" id="step-complete">
                <div class="step-icon">âœ…</div>
                <div class="step-label">å®Œäº†</div>
            </div>
        </div>
        <p class="progress-text" id="progress-text">å‡¦ç†ä¸­...</p>
    </div>
</section>
```

#### ã‚¿ã‚¹ã‚¯2-2: ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼CSSè¿½åŠ 
**ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«**: `web/css/style.css`

**è¿½åŠ CSS**:
```css
.progress-section {
    margin-bottom: 30px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
}

.progress-container {
    margin-top: 15px;
}

.progress-bar {
    width: 100%;
    height: 8px;
    background: #e9ecef;
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 20px;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #3498db, #2ecc71);
    width: 0%;
    transition: width 0.5s ease;
}

.progress-steps {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
}

.step {
    text-align: center;
    flex: 1;
    opacity: 0.4;
    transition: opacity 0.3s;
}

.step.active {
    opacity: 1;
}

.step.completed {
    opacity: 1;
    color: #2ecc71;
}

.step-icon {
    font-size: 32px;
    margin-bottom: 5px;
}

.step-label {
    font-size: 12px;
    color: #666;
}

.progress-text {
    text-align: center;
    color: #666;
    font-weight: 500;
}
```

#### ã‚¿ã‚¹ã‚¯2-3: ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ãƒ­ã‚¸ãƒƒã‚¯è¿½åŠ 
**ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«**: `web/js/main.js`

**è¿½åŠ æ©Ÿèƒ½**:
```javascript
class ProgressManager {
    constructor() {
        this.currentJobId = null;
        this.pollInterval = null;
    }
    
    startMonitoring(jobId) {
        this.currentJobId = jobId;
        this.showProgressSection();
        this.pollInterval = setInterval(() => this.updateProgress(), 3000);
    }
    
    stopMonitoring() {
        if (this.pollInterval) {
            clearInterval(this.pollInterval);
            this.pollInterval = null;
        }
    }
    
    showProgressSection() {
        document.getElementById('progress-section').style.display = 'block';
    }
    
    hideProgressSection() {
        document.getElementById('progress-section').style.display = 'none';
    }
    
    async updateProgress() {
        try {
            const job = await window.dynamoClient.getJob(this.currentJobId);
            if (!job) return;
            
            this.updateProgressUI(job.status);
            
            if (job.status === 'COMPLETED' || job.status === 'ERROR') {
                this.stopMonitoring();
                if (job.status === 'COMPLETED') {
                    this.showCompletionMessage();
                }
            }
        } catch (error) {
            console.error('é€²æ—æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
        }
    }
    
    updateProgressUI(status) {
        const statusMap = {
            'UPLOADED': { percent: 20, step: 'upload', text: 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†' },
            'TRANSCRIBING': { percent: 40, step: 'transcribe', text: 'æ–‡å­—èµ·ã“ã—ä¸­...' },
            'SUMMARIZING': { percent: 60, step: 'summarize', text: 'è¦ç´„ç”Ÿæˆä¸­...' },
            'ANALYZING': { percent: 80, step: 'analyze', text: 'æ„Ÿæƒ…åˆ†æä¸­...' },
            'COMPLETED': { percent: 100, step: 'complete', text: 'å‡¦ç†å®Œäº†ï¼' }
        };
        
        const progress = statusMap[status] || statusMap['UPLOADED'];
        
        // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼æ›´æ–°
        document.getElementById('progress-fill').style.width = progress.percent + '%';
        document.getElementById('progress-text').textContent = progress.text;
        
        // ã‚¹ãƒ†ãƒƒãƒ—ã‚¢ã‚¤ã‚³ãƒ³æ›´æ–°
        const steps = ['upload', 'transcribe', 'summarize', 'analyze', 'complete'];
        const currentIndex = steps.indexOf(progress.step);
        
        steps.forEach((step, index) => {
            const element = document.getElementById(`step-${step}`);
            element.classList.remove('active', 'completed');
            if (index < currentIndex) {
                element.classList.add('completed');
            } else if (index === currentIndex) {
                element.classList.add('active');
            }
        });
    }
    
    showCompletionMessage() {
        alert('å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸï¼ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã§ãã¾ã™ã€‚');
        this.hideProgressSection();
    }
}

window.progressManager = new ProgressManager();
```

#### ã‚¿ã‚¹ã‚¯2-4: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚ã®ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹é–‹å§‹
**ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«**: `web/js/upload.js`

**ä¿®æ­£ç®‡æ‰€**: `performS3Upload` ãƒ¡ã‚½ãƒƒãƒ‰ã®æœ€å¾Œã«è¿½åŠ 
```javascript
// ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ç›£è¦–é–‹å§‹
if (window.progressManager) {
    window.progressManager.startMonitoring(uploadResult.jobId);
}
```

---

### 3. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆDynamoDBåˆæœŸåŒ–ï¼‰

#### ã‚¿ã‚¹ã‚¯3-1: åˆæœŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¨­å®š
**ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«**: `web/js/dynamo-client.js`

**ç¢ºèªäº‹é …**: `createJob` ãƒ¡ã‚½ãƒƒãƒ‰ãŒæ—¢ã«æ­£ã—ãå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
```javascript
Item: {
    job_id: jobData.job_id,
    user_id: userId,
    file_name: jobData.file_name,
    file_size: jobData.file_size,
    file_type: jobData.file_type,
    status: 'UPLOADED',  // åˆæœŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
    created_at: new Date().toISOString(),
    updated_at: new Date().toISOString(),
    s3_upload_key: jobData.s3_upload_key,
    transcript_s3_key: null,
    summary_s3_key: null,
    sentiment_s3_key: null,
    error_message: null
}
```

#### ã‚¿ã‚¹ã‚¯3-2: DynamoDBæ¥ç¶šãƒ†ã‚¹ãƒˆ
**ç›®çš„**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰DynamoDBã¸ã®æ¥ç¶šç¢ºèª

**ãƒ†ã‚¹ãƒˆæ‰‹é †**:
1. ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Ÿè¡Œ
2. DynamoDBã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆã‚’ç¢ºèª
3. `getJob` ãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒ¬ã‚³ãƒ¼ãƒ‰å–å¾—ã‚’ç¢ºèª

---

## å®Ÿè£…é †åº

### ãƒ•ã‚§ãƒ¼ã‚º0: DynamoDBä½œæˆï¼ˆ15-30åˆ†ï¼‰
1. DynamoDBãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆï¼ˆAWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¾ãŸã¯CLIï¼‰
2. IAMãƒ­ãƒ¼ãƒ«ã«æ¨©é™è¿½åŠ ï¼ˆStep Functionsç”¨ï¼‰
3. Identity Poolã«æ¨©é™è¿½åŠ ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç”¨ï¼‰

### ãƒ•ã‚§ãƒ¼ã‚º1: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆ1-2æ™‚é–“ï¼‰
1. ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼UIè¿½åŠ ï¼ˆHTML/CSSï¼‰
2. ProgressManagerã‚¯ãƒ©ã‚¹å®Ÿè£…
3. ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚ã®ç›£è¦–é–‹å§‹å‡¦ç†è¿½åŠ 
4. DynamoDBæ¥ç¶šãƒ†ã‚¹ãƒˆ

### ãƒ•ã‚§ãƒ¼ã‚º2: ã‚¤ãƒ³ãƒ•ãƒ©ï¼ˆ1-2æ™‚é–“ï¼‰
1. Step Functionsã«DynamoDBæ›´æ–°ã‚¹ãƒ†ãƒƒãƒ—è¿½åŠ 
2. å„å‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—ã®å‰ã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ã‚’æŒ¿å…¥
3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¿½åŠ 
4. Step Functionsãƒ‡ãƒ—ãƒ­ã‚¤

### ãƒ•ã‚§ãƒ¼ã‚º3: ãƒ†ã‚¹ãƒˆï¼ˆ30åˆ†-1æ™‚é–“ï¼‰
1. ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
2. DynamoDBãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆç¢ºèª
3. ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼è¡¨ç¤ºç¢ºèª
4. å„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é·ç§»ç¢ºèª
5. å®Œäº†æ™‚ã®å‹•ä½œç¢ºèª

---

## å•é¡Œã¨ä¿®æ­£æ¡ˆ

### å•é¡Œ1: Job IDã®ä¸ä¸€è‡´
**ç¾è±¡**: 
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒä½œæˆã™ã‚‹Job ID: `job_1762999058153_7qt2o54zq_testdata-miura`
- Step FunctionsãŒæ›´æ–°ã™ã‚‹Job ID: `job_1762999058153_7qt2o54zq`
- 2ã¤ã®ç•°ãªã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒä½œæˆã•ã‚Œã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯æ›´æ–°ã‚’æ¤œçŸ¥ã§ããªã„

**åŸå› **:
- Step FunctionsãŒ `CreateCleanJobId` ã§ãƒ•ã‚¡ã‚¤ãƒ«åéƒ¨åˆ†ã‚’å‰Šé™¤ã—ã¦ã„ã‚‹
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯å®Œå…¨ãªJob IDã§ãƒãƒ¼ãƒªãƒ³ã‚°ã—ã¦ã„ã‚‹

**ä¿®æ­£æ¡ˆA: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å´ã§Job IDã‚’çŸ­ç¸®ï¼ˆæ¨å¥¨ï¼‰**

`web/js/upload.js` ã® `performS3Upload` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä¿®æ­£:
```javascript
// Job IDã‹ã‚‰å…ˆé ­3è¦ç´ ã®ã¿ã‚’æŠ½å‡ºï¼ˆStep Functionsã¨åŒã˜å½¢å¼ï¼‰
const cleanJobId = uploadResult.jobId.split('_').slice(0, 3).join('_');

// DynamoDBã«ã‚¸ãƒ§ãƒ–ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆï¼ˆçŸ­ç¸®ç‰ˆJob IDã‚’ä½¿ç”¨ï¼‰
if (window.dynamoClient) {
    await window.dynamoClient.createJob({
        job_id: cleanJobId,  // çŸ­ç¸®ç‰ˆã‚’ä½¿ç”¨
        file_name: file.name,
        file_size: file.size,
        file_type: file.type,
        s3_upload_key: uploadResult.s3Key,
        status: 'UPLOADED'
    });
}

// ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ç›£è¦–ã‚‚çŸ­ç¸®ç‰ˆJob IDã§é–‹å§‹
if (window.progressManager) {
    window.progressManager.startMonitoring(cleanJobId);
}
```

**ä¿®æ­£æ¡ˆB: Step Functionså´ã§ãƒ•ãƒ«Job IDã‚’ä½¿ç”¨**

Step Functionsã® `CreateCleanJobId` ã‚’ä¿®æ­£ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ä¿æŒ:
```json
"CreateCleanJobId": {
  "Type": "Pass",
  "Parameters": {
    "detail.$": "$.detail",
    "Full_Job_ID.$": "$.Full_Job_ID",
    "Process_ID.$": "$.Full_Job_ID",
    "Job_ID.$": "$.Full_Job_ID"
  },
  "Next": "UpdateStatusTranscribing"
}
```

**æ¨å¥¨**: ä¿®æ­£æ¡ˆAã‚’æ¡ç”¨ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å´ã®ä¿®æ­£ã®ã¿ã§å¯¾å¿œå¯èƒ½ï¼‰

---

### å•é¡Œ2: DynamoDBãƒ¬ã‚³ãƒ¼ãƒ‰ã®é‡è¤‡
**ç¾è±¡**: 
- åŒã˜ã‚¸ãƒ§ãƒ–ã§2ã¤ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒä½œæˆã•ã‚Œã‚‹
- 1ã¤ã¯ `UPLOADED` ã®ã¾ã¾
- ã‚‚ã†1ã¤ã¯ `ANALYZING` ã¾ã§é€²ã‚€

**ä¿®æ­£**: ä¿®æ­£æ¡ˆAã‚’é©ç”¨ã™ã‚Œã°è§£æ±º

---

## æŠ€è¡“çš„ãªæ³¨æ„ç‚¹

### DynamoDBã‚¢ã‚¯ã‚»ã‚¹æ¨©é™
**Step Functionsç”¨**:
- æ—¢å­˜ãƒ­ãƒ¼ãƒ«: `minutes-app-team-a-iamrole_comprehend` ã«ä»¥ä¸‹ã®æ¨©é™ã‚’è¿½åŠ 
```json
{
  "Effect": "Allow",
  "Action": [
    "dynamodb:PutItem",
    "dynamodb:UpdateItem",
    "dynamodb:GetItem"
  ],
  "Resource": "arn:aws:dynamodb:ap-northeast-1:011152093280:table/minutes-app-team-a-dynamodb"
}
```

**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç”¨ï¼ˆIdentity Poolï¼‰**:
- Identity Pool: `ap-northeast-1:865e8342-6bdc-4f1f-ba5b-0c07164b112e` ã®èªè¨¼æ¸ˆã¿ãƒ­ãƒ¼ãƒ«ã«æ¨©é™è¿½åŠ 
```json
{
  "Effect": "Allow",
  "Action": [
    "dynamodb:PutItem",
    "dynamodb:GetItem",
    "dynamodb:Scan",
    "dynamodb:Query"
  ],
  "Resource": "arn:aws:dynamodb:ap-northeast-1:011152093280:table/minutes-app-team-a-dynamodb"
}
```

### ãƒãƒ¼ãƒªãƒ³ã‚°é–“éš”
- 3ç§’é–“éš”ã§DynamoDBã‚’ãƒãƒ¼ãƒªãƒ³ã‚°ï¼ˆAWSæ–™é‡‘è€ƒæ…®ï¼‰
- å‡¦ç†å®Œäº†/ã‚¨ãƒ©ãƒ¼æ™‚ã¯è‡ªå‹•åœæ­¢

### Job IDå½¢å¼
- Step Functionsã§ä½¿ç”¨ã™ã‚‹ `Process_ID` ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã® `job_id` ã®æ•´åˆæ€§ç¢ºèª
- ç¾åœ¨: `job_TIMESTAMP_RANDOM_FILENAME` å½¢å¼
- Step Functions: `TIMESTAMP_RANDOM_FILENAME` å½¢å¼ï¼ˆå…ˆé ­3è¦ç´ ï¼‰

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- DynamoDBæ¥ç¶šã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã®ã¿ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’å¦¨ã’ãªã„ï¼‰
- Step Functionså¤±æ•—æ™‚ã¯ `ERROR` ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã«æ›´æ–°

---

## æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“å‘ä¸Š**: å‡¦ç†çŠ¶æ³ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å¯è¦–åŒ–
2. **ä¸å®‰è§£æ¶ˆ**: ã€Œå‡¦ç†ä¸­...ã€ã‹ã‚‰é€²ã¾ãªã„å•é¡Œã®è§£æ±º
3. **é€æ˜æ€§**: ã©ã®å‡¦ç†ã§æ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã‚‹ã‹æŠŠæ¡å¯èƒ½
4. **ã‚¨ãƒ©ãƒ¼æ¤œçŸ¥**: å‡¦ç†å¤±æ•—æ™‚ã®æ—©æœŸç™ºè¦‹

---

## å°†æ¥çš„ãªæ‹¡å¼µæ¡ˆ

- WebSocketï¼ˆAPI Gateway + Lambdaï¼‰ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥
- å‡¦ç†æ™‚é–“ã®äºˆæ¸¬è¡¨ç¤º
- è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸¦è¡Œå‡¦ç†çŠ¶æ³è¡¨ç¤º
- ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ï¼ˆå‡¦ç†å®Œäº†æ™‚ï¼‰
